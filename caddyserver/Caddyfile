localhost {

    # see certs/README.md for command to create this
    tls /etc/caddy/certs/localhost.crt /etc/caddy/certs/localhost.key

    handle_path /remark/* {
        abort /auth/logout
        abort /logout
        rewrite /login /auth/anonymous/login?site=atlasview&user={http.auth.user.id}&aud=atlasview 
        reverse_proxy remark:8080
    }

    handle {
        reverse_proxy shiny:3838 {
            header_up ATLASVIEW_USER "{http.auth.user.id}"
        }
    }

    basicauth /* {
        import ./users
    }

}

